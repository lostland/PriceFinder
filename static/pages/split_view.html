<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>두 창 보기 – URL 미러</title>
  <style>
    :root {
      --gap: 10px;
      --border: 1px solid #e5e7eb;
      --bg: #f9fafb;
      --txt: #111827;
      --muted: #6b7280;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--txt); font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Apple SD Gothic Neo, "Malgun Gothic", "맑은 고딕", "Helvetica Neue", Arial, "Noto Color Emoji", "Apple Color Emoji", sans-serif; }
    #app { display: flex; flex-direction: column; height: 100vh; }
    #top { position: relative; flex: 1 1 70%; min-height: 40vh; border-bottom: var(--border); background: white; }
    #viewer { position: absolute; inset: 0; width: 100%; height: 100%; border: 0; }
    #note {
      position: absolute;
      right: 12px; top: 12px;
      background: rgba(17,24,39,0.06);
      color: #374151;
      padding: 8px 10px;
      border-radius: 8px;
      font-size: 12px;
      backdrop-filter: blur(4px);
    }
    #bottom {
      flex: 0 0 30%;
      display: flex; flex-direction: column; gap: var(--gap);
      padding: 14px 16px;
      background: #ffffff;
    }
    .row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .row label { font-weight: 600; }
    .link {
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: inline-block;
      vertical-align: bottom;
      color: #2563eb;
      text-decoration: none;
      border-bottom: 1px dotted #93c5fd;
    }
    .link:hover { text-decoration: underline; }
    .help { margin: 0; color: var(--muted); font-size: 13px; }
    button.copy {
      border: var(--border);
      background: #f3f4f6;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 13px;
    }
    code { background: #f3f4f6; border-radius: 6px; padding: 2px 6px; }
    @media (max-width: 640px) {
      #bottom { flex-basis: 40%; }
      #top { flex-basis: 60%; }
    }
  </style>
</head>
<body>
  <div id="app">
    <section id="top">
      <iframe id="viewer" src="about:blank" referrerpolicy="no-referrer"></iframe>
      <div id="note">로딩 중… 일부 웹사이트는 보안정책(X-Frame-Options/CSP)으로 임베드가 차단될 수 있어요.</div>
    </section>
    <section id="bottom">
      <div class="row">
        <label for="addr">전달된 주소:</label>
        <a id="addr" class="link" target="_blank" rel="noopener">전달된 주소가 없습니다</a>
        <button id="copy" class="copy" type="button">복사</button>
      </div>
      <p class="help">
        사용법: 이 파일을 열 때 주소창 뒤에 <code>?url=https%3A%2F%2Fexample.com</code> 처럼 붙여주세요.<br />
        예) <code>file:///.../split_view.html?url=https%3A%2F%2Fwww.python.org</code>
      </p>
    </section>
  </div>

  <script>
    function getUrlParam() {
      const params = new URLSearchParams(window.location.search);
      return (params.get("url") || params.get("u") || "").trim();
    }
    function validHttpUrl(str) {
      try {
        const u = new URL(str);
        return ["http:", "https:"].includes(u.protocol);
      } catch (e) { return false; }
    }
    const url = getUrlParam();
    const iframe = document.getElementById("viewer");
    const link = document.getElementById("addr");
    const note = document.getElementById("note");
    const copyBtn = document.getElementById("copy");

    if (url && validHttpUrl(url)) {
      iframe.src = url;
      link.textContent = url;
      link.href = url;
    } else if (url) {
      link.textContent = "지원하지 않는 주소 형식입니다";
      link.removeAttribute("href");
      note.style.display = "none";
    } else {
      link.textContent = "전달된 주소가 없습니다 (?url=... 사용)";
      link.removeAttribute("href");
      note.style.display = "none";
    }

    iframe.addEventListener("load", () => {
      // 페이지가 로드되면 안내 배지를 숨깁니다.
      note.style.display = "none";
    });

    copyBtn.addEventListener("click", async () => {
      const text = link.textContent || "";
      if (!/^https?:\/\//i.test(text)) return;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = "복사됨";
        setTimeout(() => (copyBtn.textContent = "복사"), 1400);
      } catch (e) {
        alert("복사 실패: " + e.message);
      }
    });
  </script>
</body>
</html>
